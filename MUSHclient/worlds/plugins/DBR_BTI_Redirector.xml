<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>

<!--
Edit plugin and change "chat_world" variable to be the name of the 
world you want chats to go to.
-->

<muclient>
<plugin
   name="BTI_Redirector"
   author="Braska"
   id="cb84a526b476f69f403517da"
   language="Lua"
   purpose="Redirects BTI messages to another world"
   date_written="2020-11-07 11:45:35"
   requires="4.08"
   version="1.0"
   >
<description trim="y">
<![CDATA[
Redirects chats to the specified world.

Add or modify "chat" triggers to capture different sorts of message.

Change the variable "chat_world" to be the name of the world chats are to go to.
]]>
</description>

</plugin>

<!--  Triggers  -->

<triggers>

  <trigger
   enabled="y"
   match="^(\+\+\+======================================================================\+\+\+)$"
   regexp="y"
   script="chat_redirect"
   omit_from_output="y"
   sequence="100"
  >
  </trigger>

  <trigger
   enabled="y"
   match="^ \[(.*)\]-\[(.*)\] -(.*)- \[(.*)\]"
   regexp="y"
   script="chat_redirect"
   omit_from_output="y"
   sequence="100"
  >
  </trigger>

  <trigger
   enabled="y"
   match="^\* (.*)\*"
   regexp="y"
   script="chat_redirect"
   omit_from_output="y"
   sequence="100"
  >
  </trigger>

  <trigger
   enabled="n"
   match="*"
   script="chat_redirect"
   name="multi_line_chat"
   omit_from_output="y"
   sequence="10"
  >
  </trigger>

</triggers>

<!--  Script  -->


<script>
<![CDATA[
chat_world = "DBR-BTI"

require "getworld"  -- handles finding the world, and sending the line

-- chat redirector
function chat_redirect (name, line, wildcards, styles)

  send_to_world (chat_world, styles)

  -- if ends with quote, end of multi-line chat
  if line:sub (-1) == '*' then
    EnableTrigger ("multi_line_chat", false)  -- no more lines to go
  else
    EnableTrigger ("multi_line_chat", true)  -- capture subsequent lines
  end -- if

end -- function chat_redirect 

]]>
</script>
</muclient>